(function(window){if(!window.history)return;var document=window.document;var documentElement=document.documentElement;var Object=window["Object"];var JSON=window["JSON"];var windowLocation=window.location;var windowHistory=window.history;var historyObject=windowHistory;var historyPushState=windowHistory.pushState;var historyReplaceState=windowHistory.replaceState;var isSupportHistoryAPI=!!historyPushState;var isSupportStateObjectInHistory="state"in windowHistory;var defineProperty=Object.defineProperty;
var locationObject=redefineProperty({},"t")?{}:document.createElement("a");var eventNamePrefix="";var addEventListenerName=window.addEventListener?"addEventListener":(eventNamePrefix="on")&&"attachEvent";var removeEventListenerName=window.removeEventListener?"removeEventListener":"detachEvent";var dispatchEventName=window.dispatchEvent?"dispatchEvent":"fireEvent";var addEvent=window[addEventListenerName];var removeEvent=window[removeEventListenerName];var dispatch=window[dispatchEventName];var settings=
{"basepath":"/","redirect":0,"type":"/"};var sessionStorageKey="__historyAPI__";var anchorElement=document.createElement("a");var lastURL=windowLocation.href;var checkUrlForPopState="";var isFireInitialState=false;var stateStorage={};var eventsList={};var lastTitle=document.title;var eventsDescriptors={"onhashchange":null,"onpopstate":null};var fastFixChrome=function(method,args){var isNeedFix=window.history!==windowHistory;if(isNeedFix)window.history=windowHistory;method.apply(windowHistory,args);
if(isNeedFix)window.history=historyObject};var historyDescriptors={"redirect":function(type,basepath){settings["basepath"]=basepath=basepath==null?settings["basepath"]:basepath;settings["type"]=type=type==null?settings["type"]:type;if(window.top==window.self){var relative=parseURL(null,false,true)._relative;var path=windowLocation.pathname+windowLocation.search;if(isSupportHistoryAPI){path=path.replace(/([^\/])$/,"$1/");if(relative!=basepath&&(new RegExp("^"+basepath+"$","i")).test(path))windowLocation.replace(relative)}else if(path!=
basepath){path=path.replace(/([^\/])\?/,"$1/?");if((new RegExp("^"+basepath,"i")).test(path))windowLocation.replace(basepath+"#"+path.replace(new RegExp("^"+basepath,"i"),type)+windowLocation.hash)}}},pushState:function(state,title,url){var t=document.title;if(lastTitle!=null)document.title=lastTitle;historyPushState&&fastFixChrome(historyPushState,arguments);changeState(state,url);document.title=t;lastTitle=title},replaceState:function(state,title,url){var t=document.title;if(lastTitle!=null)document.title=
lastTitle;delete stateStorage[windowLocation.href];historyReplaceState&&fastFixChrome(historyReplaceState,arguments);changeState(state,url,true);document.title=t;lastTitle=title},"location":{set:function(value){window.location=value},get:function(){return isSupportHistoryAPI?windowLocation:locationObject}},"state":{get:function(){return stateStorage[windowLocation.href]||null}}};var locationDescriptors={assign:function(url){if((""+url).indexOf("#")===0)changeState(null,url);else windowLocation.assign(url)},
reload:function(){windowLocation.reload()},replace:function(url){if((""+url).indexOf("#")===0)changeState(null,url,true);else windowLocation.replace(url)},toString:function(){return this.href},"href":{get:function(){return parseURL()._href}},"protocol":null,"host":null,"hostname":null,"port":null,"pathname":{get:function(){return parseURL()._pathname}},"search":{get:function(){return parseURL()._search}},"hash":{set:function(value){changeState(null,(""+value).replace(/^(#|)/,"#"),false,lastURL)},
get:function(){return parseURL()._hash}}};function emptyFunction(){}function parseURL(href,isWindowLocation,isNotAPI){var re=/(?:([\w0-9]+:))?(?:\/\/(?:[^@]*@)?([^\/:\?#]+)(?::([0-9]+))?)?([^\?#]*)(?:(\?[^#]+)|\?)?(?:(#.*))?/;if(href!=null&&(href!==""&&!isWindowLocation)){var current=parseURL(),_pathname=current._pathname,_protocol=current._protocol;href=""+href;href=/^(?:[\w0-9]+\:)?\/\//.test(href)?href.indexOf("/")===0?_protocol+href:href:_protocol+"//"+current._host+(href.indexOf("/")===0?href:
href.indexOf("?")===0?_pathname+href:href.indexOf("#")===0?_pathname+current._search+href:_pathname.replace(/[^\/]+$/g,"")+href)}else{href=isWindowLocation?href:windowLocation.href;if(!isSupportHistoryAPI||isNotAPI){href=href.replace(/^[^#]*/,"")||"#";href=windowLocation.protocol+"//"+windowLocation.host+settings["basepath"]+href.replace(new RegExp("^#[/]?(?:"+settings["type"]+")?"),"")}}anchorElement.href=href;var result=re.exec(anchorElement.href);var host=result[2]+(result[3]?":"+result[3]:"");
var pathname=result[4]||"/";var search=result[5]||"";var hash=result[6]==="#"?"":result[6]||"";var relative=pathname+search+hash;var nohash=pathname.replace(new RegExp("^"+settings["basepath"],"i"),settings["type"])+search;return{_href:result[1]+"//"+host+relative,_protocol:result[1],_host:host,_hostname:result[2],_port:result[3]||"",_pathname:pathname,_search:search,_hash:hash,_relative:relative,_nohash:nohash,_special:nohash+hash}}function storageInitialize(){var sessionStorage;try{sessionStorage=
window["sessionStorage"];sessionStorage.setItem(sessionStorageKey+"t","1");sessionStorage.removeItem(sessionStorageKey+"t")}catch(_e_){sessionStorage={getItem:function(key){var cookie=document.cookie.split(key+"=");return cookie.length>1&&cookie.pop().split(";").shift()||"null"},setItem:function(key,value){var state={};if(state[windowLocation.href]=historyObject.state)document.cookie=key+"="+JSON.stringify(state)}}}try{stateStorage=JSON.parse(sessionStorage.getItem(sessionStorageKey))||{}}catch(_e_){stateStorage=
{}}addEvent(eventNamePrefix+"unload",function(){sessionStorage.setItem(sessionStorageKey,JSON.stringify(stateStorage))},false)}function redefineProperty(object,prop,descriptor,onWrapped){descriptor=descriptor||{set:emptyFunction};var isDefinedSetter=!descriptor.set;var isDefinedGetter=!descriptor.get;var test={configurable:true,set:function(){isDefinedSetter=1},get:function(){isDefinedGetter=1}};try{defineProperty(object,prop,test);object[prop]=object[prop];defineProperty(object,prop,descriptor)}catch(_e_){}if(!isDefinedSetter||
!isDefinedGetter){if(object.__defineGetter__){object.__defineGetter__(prop,test.get);object.__defineSetter__(prop,test.set);object[prop]=object[prop];descriptor.get&&object.__defineGetter__(prop,descriptor.get);descriptor.set&&object.__defineSetter__(prop,descriptor.set)}if((!isDefinedSetter||!isDefinedGetter)&&object===window){try{var originalValue=object[prop];object[prop]=null}catch(_e_){}if("execScript"in window)window["execScript"]("Public "+prop,"VBScript");else try{defineProperty(object,prop,
{value:emptyFunction})}catch(_e_){}object[prop]=originalValue}else if(!isDefinedSetter||!isDefinedGetter)try{try{var temp=Object.create(object);defineProperty(Object.getPrototypeOf(temp)===object?temp:object,prop,descriptor);for(var key in object)if(typeof object[key]==="function")temp[key]=object[key].bind(object);try{onWrapped.call(temp,temp,object)}catch(_e_){}object=temp}catch(_e_){defineProperty(object.constructor.prototype,prop,descriptor)}}catch(_e_){return false}}return object}function prepareDescriptorsForObject(object,
prop,descriptor){descriptor=descriptor||{};object=object===locationDescriptors?windowLocation:object;descriptor.set=descriptor.set||function(value){object[prop]=value};descriptor.get=descriptor.get||function(){return object[prop]};return descriptor}function addEventListener(event,listener,capture){if(event in eventsList)eventsList[event].push(listener);else if(arguments.length>3)addEvent(event,listener,capture,arguments[3]);else addEvent(event,listener,capture)}function removeEventListener(event,
listener,capture){var list=eventsList[event];if(list)for(var i=list.length;--i;){if(list[i]===listener){list.splice(i,1);break}}else removeEvent(event,listener,capture)}function dispatchEvent(event,eventObject){var eventType=(""+(typeof event==="string"?event:event.type)).replace(/^on/,"");var list=eventsList[eventType];if(list){eventObject=typeof event==="string"?eventObject:event;if(eventObject.target==null)for(var props=["target","currentTarget","srcElement","type"];event=props.pop();)eventObject=
redefineProperty(eventObject,event,{get:event==="type"?function(){return eventType}:function(){return window}});((eventType==="popstate"?window.onpopstate:window.onhashchange)||emptyFunction).call(window,eventObject);for(var i=0,len=list.length;i<len;i++)list[i].call(window,eventObject);return true}else return dispatch(event,eventObject)}function firePopState(){var o=document.createEvent?document.createEvent("Event"):document.createEventObject();if(o.initEvent)o.initEvent("popstate",false,false);
else o.type="popstate";o.state=historyObject.state;dispatchEvent(o)}function fireInitialState(){if(isFireInitialState){isFireInitialState=false;firePopState()}}function changeState(state,url,replace,lastURLValue){if(!isSupportHistoryAPI){var urlObject=parseURL(url);if(urlObject._relative!==parseURL()._relative){lastURL=lastURLValue;if(replace)windowLocation.replace("#"+urlObject._special);else windowLocation.hash=urlObject._special}}if(!isSupportStateObjectInHistory&&state)stateStorage[windowLocation.href]=
state;isFireInitialState=false}function onHashChange(event){if(lastURL){if(checkUrlForPopState!==windowLocation.href)firePopState();event=event||window.event;var oldURLObject=parseURL(lastURL,true);var newURLObject=parseURL();if(!event.oldURL){event.oldURL=oldURLObject._href;event.newURL=newURLObject._href}if(oldURLObject._hash!==newURLObject._hash)dispatchEvent(event)}lastURL=windowLocation.href}function onLoad(noScroll){setTimeout(function(){addEvent("popstate",function(e){checkUrlForPopState=windowLocation.href;
if(!isSupportStateObjectInHistory)e=redefineProperty(e,"state",{get:function(){return historyObject.state}});dispatchEvent(e)},false)},0);if(!isSupportHistoryAPI&&(noScroll!==true&&historyObject.location)){scrollToAnchorId(historyObject.location.hash);fireInitialState()}}function anchorTarget(target){while(target){if(target.nodeName==="A")return target;target=target.parentNode}}function onAnchorClick(e){var event=e||window.event;var target=anchorTarget(event.target||event.srcElement);var defaultPrevented=
"defaultPrevented"in event?event["defaultPrevented"]:event.returnValue===false;if(target&&(target.nodeName==="A"&&!defaultPrevented)){var current=parseURL();var expect=parseURL(target.getAttribute("href",2));var isEqualBaseURL=current._href.split("#").shift()===expect._href.split("#").shift();if(isEqualBaseURL&&expect._hash){if(current._hash!==expect._hash)historyObject.location.hash=expect._hash;scrollToAnchorId(expect._hash);if(event.preventDefault)event.preventDefault();else event.returnValue=
false}}}function scrollToAnchorId(hash){var target=document.getElementById(hash=(hash||"").replace(/^#/,""));if(target&&(target.id===hash&&target.nodeName==="A")){var rect=target.getBoundingClientRect();window.scrollTo(documentElement.scrollLeft||0,rect.top+(documentElement.scrollTop||0)-(documentElement.clientTop||0))}}function initialize(){var scripts=document.getElementsByTagName("script");var src=(scripts[scripts.length-1]||{}).src||"";var arg=src.indexOf("?")!==-1?src.split("?").pop():"";arg.replace(/(\w+)(?:=([^&]*))?/g,
function(a,key,value){settings[key]=(value||(key==="basepath"?"/":"")).replace(/^(0|false)$/,"")});ie6DriverStart();addEvent(eventNamePrefix+"hashchange",onHashChange,false);var data=[locationDescriptors,locationObject,eventsDescriptors,window,historyDescriptors,historyObject];if(isSupportStateObjectInHistory)delete historyDescriptors["state"];for(var i=0;i<data.length;i+=2)for(var prop in data[i])if(data[i].hasOwnProperty(prop))if(typeof data[i][prop]==="function")data[i+1][prop]=data[i][prop];else{var descriptor=
prepareDescriptorsForObject(data[i],prop,data[i][prop]);if(!redefineProperty(data[i+1],prop,descriptor,function(n,o){if(o===historyObject)window.history=historyObject=data[i+1]=n})){removeEvent(eventNamePrefix+"hashchange",onHashChange,false);return false}if(data[i+1]===window)eventsList[prop]=eventsList[prop.substr(2)]=[]}if(settings["redirect"])historyObject["redirect"]();if(!isSupportStateObjectInHistory&&JSON)storageInitialize();if(!isSupportHistoryAPI)document[addEventListenerName](eventNamePrefix+
"click",onAnchorClick,false);if(document.readyState==="complete")onLoad(true);else{if(!isSupportHistoryAPI&&parseURL()._relative!==settings["basepath"])isFireInitialState=true;addEvent(eventNamePrefix+"load",onLoad,false)}return true}if(!initialize())return;historyObject["emulate"]=!isSupportHistoryAPI;window[addEventListenerName]=addEventListener;window[removeEventListenerName]=removeEventListener;window[dispatchEventName]=dispatchEvent;function ie6DriverStart(){function createVBObjects(object){var properties=
[];var className="VBHistoryClass"+(new Date).getTime()+msie++;var staticClassParts=["Class "+className];for(var prop in object)if(object.hasOwnProperty(prop)){var value=object[prop];if(value&&(value.get||value.set)){if(value.get)staticClassParts.push("Public "+(prop==="_"?"Default ":"")+"Property Get ["+prop+"]","Call VBCVal([(accessors)].["+prop+"].get.call(me),["+prop+"])","End Property");if(value.set)staticClassParts.push("Public Property Let ["+prop+"](val)",value="Call [(accessors)].["+prop+
"].set.call(me,val)\nEnd Property","Public Property Set ["+prop+"](val)",value)}else{properties.push(prop);staticClassParts.push("Public ["+prop+"]")}}staticClassParts.push("Private [(accessors)]","Private Sub Class_Initialize()","Set [(accessors)]="+className+"FactoryJS()","End Sub","End Class","Function "+className+"Factory()","Set "+className+"Factory=New "+className,"End Function");window["execScript"](staticClassParts.join("\n"),"VBScript");window[className+"FactoryJS"]=function(){return object};
var result=window[className+"Factory"]();for(var i=0;i<properties.length;i++)result[properties[i]]=object[properties[i]];return result}function quote(string){var escapable=/[\\"\u0000-\u001f\u007f-\u009f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g;var meta={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"};return escapable.test(string)?'"'+string.replace(escapable,function(a){return a in meta?meta[a]:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+
'"':'"'+string+'"'}var msie=window["eval"]&&eval("/*@cc_on 1;@*/");if(!msie||+(/msie (\d+)/i.exec(navigator.userAgent)||[,8])[1]>7)return;var originalChangeState=changeState;var originalRedefineProperty=redefineProperty;var currentHref=parseURL()._href;var iFrame=document.createElement("iframe");iFrame.src="javascript:true;";iFrame=documentElement.firstChild.appendChild(iFrame).contentWindow;window["execScript"]("Public history\nFunction VBCVal(o,r) If IsObject(o) Then Set r=o Else r=o End If End Function",
"VBScript");locationObject={"_":{get:locationDescriptors.toString}};historyObject={"back":windowHistory.back,"forward":windowHistory.forward,"go":windowHistory.go,"emulate":null,"_":{get:function(){return"[object History]"}}};JSON={"parse":function(value){try{return(new Function("","return "+value))()}catch(_e_){return null}},"stringify":function(value){var n=(typeof value).charCodeAt(2);return n===114?quote(value):n===109?isFinite(value)?String(value):"null":n===111||n===108?String(value):n===106?
!value?"null":function(isArray){var out=isArray?"[":"{";if(isArray)for(var i=0;i<value.length;i++)out+=(i==0?"":",")+JSON.stringify(value[i]);else for(var k in value)if(value.hasOwnProperty(k))out+=(out.length==1?"":",")+quote(k)+":"+JSON.stringify(value[k]);return out+(isArray?"]":"}")}(Object.prototype.toString.call(value)==="[object Array]"):"void 0"}};changeState=function(state,url,replace,lastURLValue,lfirst){var iFrameDocument=iFrame.document;var urlObject=parseURL(url);isFireInitialState=false;
if(urlObject._relative===parseURL()._relative&&!lfirst){if(state)stateStorage[windowLocation.href]=state;return}lastURL=lastURLValue;if(replace)if(iFrame["lfirst"]){history.back();changeState(state,urlObject._href,0,lastURLValue,1)}else windowLocation.replace("#"+urlObject._special);else if(urlObject._href!=currentHref||lfirst){if(!iFrame["lfirst"]){iFrame["lfirst"]=1;changeState(state,currentHref,0,lastURLValue,1)}iFrameDocument.open();iFrameDocument.write('<script>lfirst=1;parent.location.hash="'+
urlObject._special.replace(/"/g,'\\"')+'";\x3c/script>');iFrameDocument.close()}if(!lfirst&&state)stateStorage[windowLocation.href]=state};redefineProperty=function(object,prop,descriptor,onWrapped){if(!originalRedefineProperty.apply(this,arguments))if(object===locationObject)locationObject[prop]=descriptor;else if(object===historyObject){historyObject[prop]=descriptor;if(prop==="state"){locationObject=createVBObjects(locationObject);window.history=historyObject=createVBObjects(historyObject)}}else object[prop]=
descriptor.get&&descriptor.get();return object};var interval=setInterval(function(){var href=parseURL()._href;if(href!=currentHref){var e=document.createEventObject();e.oldURL=currentHref;e.newURL=currentHref=href;e.type="hashchange";onHashChange(e)}},100);window["JSON"]=JSON}})(window);
(function(){function m(c,e,b){"undefined"==typeof b&&(b=e,e={});"undefined"==typeof b&&(b=c,c={});c=c||{};b=b||[];k.b(c,{push:function(a){this.attr(this.length++,a)},pop:function(){var a=this.attr(this.length-1);this.removeAttr(this.length-1);this.length--;return a},shift:function(){var a=Array.prototype.shift.apply(this);this.trigger("remove","0",a,void 0);return a},unshift:function(){var a=Array.prototype.unshift.apply(this,arguments);if(1<arguments.length){var g=Array.prototype.slice.call(arguments,
0,arguments.length);this.trigger("add","0",void 0,g)}else 1==arguments.length&&this.trigger("add","0",void 0,arguments[0]);return a},slice:function(a,g){arguments[0]=arguments[0]||0;arguments[1]=arguments[1]||this.length;var b=Array.prototype.slice.apply(this,arguments);return new d.List(b)},splice:function(a,g){arguments[0]=arguments[0]||0;arguments[1]=arguments[1]||this.length;var b=Array.prototype.splice.apply(this,arguments);this.keys=[];for(var c=0;c<this.length;c++)this.keys.push(c);this.trigger("remove",
a,b,void 0);2<arguments.length&&(c=Array.prototype.slice.call(arguments,2,arguments.length),this.trigger("add",a,void 0,c));return new d.List(b)},indexOf:function(){return Array.prototype.indexOf.apply(this,arguments)},join:function(){return Array.prototype.join.apply(this,arguments)},forEach:function(){Array.prototype.forEach.apply(this,arguments)},concat:function(){var a=Array.prototype.slice.call(this,0,this.length);return new d.List(Array.prototype.concat.apply(a,arguments))}});return d.Map.extend(c,
e,{init:function(a){k.b(this,b);this.length=0;if(a instanceof Array){this.length=a.length;for(var g=0;g<a.length;g++)this[g]=a[g]}else if(0<arguments.length)for(this.length=arguments.length,g=0;g<arguments.length;g++)this[g]=arguments[g]}})}function n(c,e,b){"undefined"==typeof b&&(b=e,e={});"undefined"==typeof b&&(b=c,c={});c=c||{};b=b||{};k.b(c,{attr:function(a,g){"number"==typeof a&&(a=String(a));if("undefined"==typeof a){var b={},c;for(c in this.keys)b[this.keys[c]]=this[this.keys[c]];return b}if("string"==
typeof a){if("undefined"==typeof g)return this[a];b="set";0>this.keys.indexOf(a)&&(this.keys.push(a),b="add");var e=this[a];this[a]=g;this.trigger(b,a,e,g)}if("object"==typeof a)for(c in a)b="set",0>this.keys.indexOf(c)&&(this.keys.push(c),b="add"),e=this[c],this[c]=a[c],this.trigger(b,c,e,a[c])},each:function(a){for(var b in this.keys)a.call(this,b,this[b])},removeAttr:function(a){"number"==typeof a&&(a=String(a));var b=this.keys.indexOf(a);0>b||(this.keys.splice(b,1),b=this[a],delete this[a],this.trigger("remove",
a,b,void 0))},bind:function(a,b){f[this.a][a]instanceof Array||(f[this.a][a]=[]);for(var c in f[this.a][a])if(f[this.a][a][c]==b)return;f[this.a][a].push(b)},unbind:function(a,b){if(f[this.a][a]instanceof Array)if("undefined"==typeof b)delete f[this.a][a];else for(var c in f[this.a][a])if(f[this.a][a][c]==b){f[this.a][a].splice(c,1);break}},trigger:function(a,b,c,e){var d=null;if("undefined"!=typeof f[this.a][b])for(var d=new l(a,b,c,e),h=0;h<f[this.a][b].length;h++)if(f[this.a][b][h].call(this,d),
d.stopPropagation)return;if("undefined"!=typeof f[this.a][a])for(d=d||new l(a,b,c,e),h=0;h<f[this.a][a].length;h++)if(f[this.a][a][h].call(this,d),d.stopPropagation)return;if("undefined"!=typeof f[this.a].change)for(d=d||new l("change",b,c,e),h=0;h<f[this.a].change.length&&(f[this.a].change[h].call(this,d),!d.stopPropagation);h++);}});return d.Construct.extend(c,e,{init:function(a){a=a||{};this.keys=[];k.b(a,b);"function"==typeof b.init&&b.init.apply(this,arguments);if("object"==typeof a)for(var c in a)this[c]=
a[c],this.keys.push(c);f.length++;this.a=c="map"+f.length;f[c]={}}})}function l(c,e,b,a){this.how=c;this.key=e;this.old_val=b;this.new_val=a;this.stopPropagation=!1}var d=window.fw||{},k=d.utils||{};k.b=function(c,e){for(var b in e)"undefined"==typeof c[b]&&"init"!=b&&(c[b]=e[b])};d.Construct=function(c,e){return d.Construct.extend({},c,e)};d.Construct.extend=function(c,e,b){function a(){"function"==typeof b.init&&b.init.apply(this,arguments);for(var a in b)"init"!=a&&(this[a]=b[a])}"undefined"==
typeof b&&(b=e,e={});"undefined"==typeof b&&(b=c,c={});c=c||{};b=b||{};a.prototype=c;a.prototype.superclass=c;a.prototype.constructor=a;for(var d in e)a[d]=e[d];return a};var f={length:0};d.Map=n();d.Map.extend=n;d.List=m();d.List.extend=m;d.compute=function(c,e){function b(b){if("undefined"!=typeof b)a.set(b);else return a.get()}e=e||{};var a=new (d.Map.extend({set:function(a){this.attr("val",a)},get:function(){return this.attr("val")}},e))({val:c});b.on=a.bind.bind(a);b.off=a.unbind.bind(a);b.trigger=
a.trigger.bind(a);return b};d.utils=k;window.fw=d})();
(function(){var fw=window.fw;if(!fw){console.error("you must first load jfw.core");return}var rsplit=function(string,regex){var result=regex.exec(string),retArr=new Array,first_idx,last_idx,first_bit;while(result!=null){first_idx=result.index;last_idx=regex.lastIndex;if(first_idx!=0){first_bit=string.substring(0,first_idx);retArr.push(string.substring(0,first_idx));string=string.slice(first_idx)}retArr.push(result[0]);string=string.slice(result[0].length);result=regex.exec(string)}if(!string=="")retArr.push(string);
return retArr},chop=function(string){return string.substr(0,string.length-1)},extend=function(d,s){for(var n in s)if(s.hasOwnProperty(n))d[n]=s[n]};var EJS=function(options){options=typeof options=="string"?{view:options}:options;this.set_options(options);if(options.precompiled){this.template={};this.template.process=options.precompiled;EJS.update(this.name,this);return}if(options.element){if(typeof options.element=="string"){var name=options.element;options.element=document.getElementById(options.element);
if(options.element==null)throw name+"does not exist!";}if(options.element.value)this.text=options.element.value;else this.text=options.element.innerHTML;this.name=options.element.id;this.type="["}else if(options.url){options.url=EJS.endExt(options.url,this.extMatch);this.name=this.name?this.name:options.url;var url=options.url;var template=EJS.get(this.name,this.cache);if(template)return template;if(template==EJS.INVALID_PATH)return null;try{this.text=EJS.request(url+(this.cache?"":"?"+Math.random()))}catch(e){}if(this.text==
null)throw{type:"EJS",message:"There is no template at "+url};}var template=new EJS.Compiler(this.text,this.type);template.compile(options,this.name);EJS.update(this.name,this);this.template=template};fw.EJS=EJS;EJS.prototype={render:function(object,extra_helpers){object=object||{};this._extra_helpers=extra_helpers;var v=new EJS.Helpers(object,extra_helpers||{});return this.template.process.call(object,object,v)},update:function(element,options){if(typeof element=="string")element=document.getElementById(element);
if(options==null){_template=this;return function(object){EJS.prototype.update.call(_template,element,object)}}if(typeof options=="string"){params={};params.url=options;_template=this;params.onComplete=function(request){var object=eval(request.responseText);EJS.prototype.update.call(_template,element,object)};EJS.ajax_request(params)}else element.innerHTML=this.render(options)},out:function(){return this.template.out},set_options:function(options){this.type=options.type||EJS.type;this.cache=options.cache!=
null?options.cache:EJS.cache;this.text=options.text||null;this.name=options.name||null;this.ext=options.ext||EJS.ext;this.extMatch=new RegExp(this.ext.replace(/\./,"."))}};EJS.endExt=function(path,match){if(!path)return null;match.lastIndex=0;return path+(match.test(path)?"":this.ext)};EJS.Scanner=function(source,left,right){extend(this,{left_delimiter:left+"%",right_delimiter:"%"+right,double_left:left+"%%",double_right:"%%"+right,left_equal:left+"%=",left_comment:left+"%#"});this.SplitRegexp=left==
"["?/(\[%%)|(%%\])|(\[%=)|(\[%#)|(\[%)|(%\]\n)|(%\])|(\n)/:new RegExp("("+this.double_left+")|(%%"+this.double_right+")|("+this.left_equal+")|("+this.left_comment+")|("+this.left_delimiter+")|("+this.right_delimiter+"\n)|("+this.right_delimiter+")|(\n)");this.source=source;this.stag=null;this.lines=0};EJS.Scanner.to_text=function(input){if(input==null||input===undefined)return"";if(input instanceof Date)return input.toDateString();if(input.toString)return input.toString();return""};EJS.Scanner.prototype=
{scan:function(block){scanline=this.scanline;regex=this.SplitRegexp;if(!this.source==""){var source_split=rsplit(this.source,/\n/);for(var i=0;i<source_split.length;i++){var item=source_split[i];this.scanline(item,regex,block)}}},scanline:function(line,regex,block){this.lines++;var line_split=rsplit(line,regex);for(var i=0;i<line_split.length;i++){var token=line_split[i];if(token!=null)try{block(token,this)}catch(e){throw{type:"EJS.Scanner",line:this.lines};}}}};EJS.Buffer=function(pre_cmd,post_cmd){this.line=
new Array;this.script="";this.pre_cmd=pre_cmd;this.post_cmd=post_cmd;for(var i=0;i<this.pre_cmd.length;i++)this.push(pre_cmd[i])};EJS.Buffer.prototype={push:function(cmd){this.line.push(cmd)},cr:function(){this.script=this.script+this.line.join("; ");this.line=new Array;this.script=this.script+"\n"},close:function(){if(this.line.length>0){for(var i=0;i<this.post_cmd.length;i++)this.push(pre_cmd[i]);this.script=this.script+this.line.join("; ");line=null}}};EJS.Compiler=function(source,left){this.pre_cmd=
["var ___ViewO = [];"];this.post_cmd=new Array;this.source=" ";if(source!=null){if(typeof source=="string"){source=source.replace(/\r\n/g,"\n");source=source.replace(/\r/g,"\n");this.source=source}else if(source.innerHTML)this.source=source.innerHTML;if(typeof this.source!="string")this.source=""}left=left||"<";var right=">";switch(left){case "[":right="]";break;case "<":break;default:throw left+" is not a supported deliminator";break}this.scanner=new EJS.Scanner(this.source,left,right);this.out=
""};EJS.Compiler.prototype={compile:function(options,name){options=options||{};this.out="";var put_cmd="___ViewO.push(";var insert_cmd=put_cmd;var buff=new EJS.Buffer(this.pre_cmd,this.post_cmd);var content="";var clean=function(content){content=content.replace(/\\/g,"\\\\");content=content.replace(/\n/g,"\\n");content=content.replace(/"/g,'\\"');return content};this.scanner.scan(function(token,scanner){if(scanner.stag==null)switch(token){case "\n":content=content+"\n";buff.push(put_cmd+'"'+clean(content)+
'");');buff.cr();content="";break;case scanner.left_delimiter:case scanner.left_equal:case scanner.left_comment:scanner.stag=token;if(content.length>0)buff.push(put_cmd+'"'+clean(content)+'")');content="";break;case scanner.double_left:content=content+scanner.left_delimiter;break;default:content=content+token;break}else switch(token){case scanner.right_delimiter:switch(scanner.stag){case scanner.left_delimiter:if(content[content.length-1]=="\n"){content=chop(content);buff.push(content);buff.cr()}else buff.push(content);
break;case scanner.left_equal:buff.push(insert_cmd+"(EJS.Scanner.to_text("+content+")))");break}scanner.stag=null;content="";break;case scanner.double_right:content=content+scanner.right_delimiter;break;default:content=content+token;break}});if(content.length>0)buff.push(put_cmd+'"'+clean(content)+'")');buff.close();this.out=buff.script+";";var to_be_evaled="/*"+name+"*/this.process = function(_CONTEXT,_VIEW) { try { with(_VIEW) { with (_CONTEXT) {"+this.out+" return ___ViewO.join('');}}}catch(e){e.lineNumber=null;throw e;}};";
try{eval(to_be_evaled)}catch(e){if(typeof JSLINT!="undefined"){JSLINT(this.out);for(var i=0;i<JSLINT.errors.length;i++){var error=JSLINT.errors[i];if(error.reason!="Unnecessary semicolon."){error.line++;var te=new Error;te.lineNumber=error.line;te.message=error.reason;if(options.view)te.fileName=options.view;throw te;}}}else throw e;}}};EJS.config=function(options){EJS.cache=options.cache!=null?options.cache:EJS.cache;EJS.type=options.type!=null?options.type:EJS.type;EJS.ext=options.ext!=null?options.ext:
EJS.ext;var templates_directory=EJS.templates_directory||{};EJS.templates_directory=templates_directory;EJS.get=function(path,cache){if(cache==false)return null;if(templates_directory[path])return templates_directory[path];return null};EJS.update=function(path,template){if(path==null)return;templates_directory[path]=template};EJS.INVALID_PATH=-1};EJS.config({cache:true,type:"<",ext:".ejs"});EJS.Helpers=function(data,extras){this._data=data;this._extras=extras;extend(this,extras)};EJS.Helpers.prototype=
{view:function(options,data,helpers){if(!helpers)helpers=this._extras;if(!data)data=this._data;return(new EJS(options)).render(data,helpers)},to_text:function(input,null_text){if(input==null||input===undefined)return null_text||"";if(input instanceof Date)return input.toDateString();if(input.toString)return input.toString().replace(/\n/g,"<br />").replace(/''/g,"'");return""}};EJS.newRequest=function(){var factories=[function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new XMLHttpRequest},
function(){return new ActiveXObject("Microsoft.XMLHTTP")}];for(var i=0;i<factories.length;i++)try{var request=factories[i]();if(request!=null)return request}catch(e){continue}};EJS.request=function(path){var request=new EJS.newRequest;request.open("GET",path,false);try{request.send(null)}catch(e){return null}if(request.status==404||(request.status==2||request.status==0&&request.responseText==""))return null;return request.responseText};EJS.ajax_request=function(params){params.method=params.method?
params.method:"GET";var request=new EJS.newRequest;request.onreadystatechange=function(){if(request.readyState==4)if(request.status==200)params.onComplete(request);else params.onComplete(request)};request.open(params.method,params.url);request.send(null)}})();
(function(){if(fw){var c={},d=new fw.Map({add:function(a,b){c[a]={b:RegExp(a),a:b}},remove:function(a){delete c[a]}});d.attr("hash",window.location.hash);window.onpopstate=function(){d.attr("hash",window.location.hash)};d.bind("hash",function(){for(var a in c)if(c[a].b.test(this.hash.replace(/^#/,""))){var b=this.hash.match(a),b=Array.prototype.slice.call(b,1,b.length);c[a].a.call(this,b);break}});fw.route=d}else console.error("you must first load jfw.core")})(window);
fw?fw.view=function(b,e){var c=null;if(/\.ejs$/.test(b))c=new EJS({url:b});else{var a=null;if(a=document.getElementById(b))c=new fw.EJS({text:a.innerHTML})}if(c)return a=function(a){var d=c.render(a);a=document.createElement("div");a.innerHTML=d;for(var d=document.createDocumentFragment(),b=0;b<a.children.length;b++)d.appendChild(a.children[b]);return d},"undefined"==typeof e?a:a(e)}:console.error("you must first load jfw.core");
fw?fw.Control=function(b){return fw.Construct.extend({},{init:function(a){this.element=jQuery(a);"function"==typeof b.init&&b.init.call(this.element);for(var c in b)if("init"!=c&&(a=c.match("^(.*)\\s(.*)$"),2<a.length))jQuery(a[1],this.element).on(a[2],b[c])}})}:console.error("you must first load jfw.core");
(function(){var g=window.fw;if(g){g.utils.a=function(a,b){for(var c=a,d=RegExp("{:(.*?)}","g"),e=null;null!=(e=d.exec(a));)"undefined"!=typeof b[e[1]]?(c=c.replace(e[0],b[e[1]]),delete b[e[1]]):c=c.replace(e[0],"");return c};var l=function(a,b,c){return function(d,e,f){d=d||this.attr();var h={},k;for(k in d)h[k]=d[k];d={type:a.toUpperCase(),url:g.utils.a(b,h),dataType:"json",cache:!1,data:h};"function"==typeof e&&(d.success=function(a){"function"==typeof c&&(a=c.call(this,a));e.call(this,a)});"function"==
typeof f&&(d.error=f);jQuery.ajax(d)}},m=function(a,b,c,d){b=b.match("^(GET|POST|PUT|DELETE)[\\s]+(.*)$");2<b.length&&(a[c]=l(b[1],b[2],function(a){return d.call(this,a)}))};g.Model=function(a){a=a||{};var b={save:function(a){"undefined"!=typeof this.__theNew?this.create(this.attr(),a):this.update(this.attr(),a)}},c={},d=g.Map.extend(b,{});"undefined"!=typeof a.findAll&&m(c,a.findAll,"findAll",function(a){var b=[];if("undefined"!=typeof a.data)for(var c in a.data){var e=new d(a.data[c]);b.push(e)}return b});
"undefined"!=typeof a.findOne&&m(c,a.findOne,"findOne",function(a){var b=null;a&&(b=new d(a));return b});for(var e in a){var f=a[e].match("^(GET|POST|PUT|DELETE)[\\s]+(.*)$");if(2<f.length)switch(e.toLowerCase()){case "create":var h=l(f[1],f[2]);b.create=function(a,b){h.call(this,null,a,b)};break;case "update":var k=l(f[1],f[2]);b.update=function(a,b){k.call(this,null,a,b)};break;case "destroy":var n=l(f[1],f[2]);b.destroy=function(a,b){this.id&&n.call(this,{id:this.id},a,b)}}}return g.Map.extend(b,
c,{init:function(){"function"==typeof a.init&&(a.init.call(this),delete a.init);this.__theNew=!0}})}}else console.error("you must first load jfw.core")})();
